<!doctype html>
<html>

<head>
    <meta charset="UTF-8">
    <title>Cron任务调度登录</title>
</head>

<link rel="stylesheet" href="style/mui.min.css">
<link rel="stylesheet" href="style/mui.showLoading.css">
<script type="text/javascript" src="jscript/mui.min.js"></script>
<script type="text/javascript" src="jscript/mui.showLoading.js"></script>
<script type="text/javascript" src="jscript/jquery-3.4.1.min.js"></script>
<script type="text/javascript" src="jscript/comm.js"></script>
<script type="text/javascript">
    $(function () {
        $('.login').click(function () {
            mui('.login').button('loading');
            $.ajax({
                url: '/api/user/login',
                type: 'post',
                data: JSON.stringify({
                    loginid: $('.loginid').val().trim(),
                    loginpwd: $('.loginpwd').val().trim().toMd5()
                }),
                success: function (data) {
                    data = JSON.parse(data);
                    mui('.login').button('reset');
                    if (!data.data) {
                        mui.alert('登录失败');
                        return;
                    }
                    data.data.loginpwd = $('.loginpwd').val().trim().toMd5();
                    window.sessionStorage['user'] = JSON.stringify(data.data);
                    if (data.data.is_change == 0) {
                        mui.alert('请先修改密码', function () {
                            window.location.href = 'user/change.html';
                        });
                    }
                    else {
                        window.location.href = 'main/list.html';
                    }
                },
                error: function () {
                    mui('.login').button('reset');
                    mui.alert('登录失败');
                }
            });
        });
    });
</script>

<body>
    <form style="width: 50%;margin-left: 25%;margin-top: 10%;" class="mui-input-group">
        <div class="mui-input-row">
            <label>用户名</label>
            <input type="text" class="loginid mui-input-clear" placeholder="请输入用户名">
        </div>
        <div class="mui-input-row">
            <label>密码</label>
            <input type="password" class="loginpwd mui-input-password" placeholder="请输入密码">
        </div>
        <div class="mui-button-row">
            <button type="button" data-loading-text="登录中" class="login mui-btn mui-btn-primary">登录</button>
        </div>
    </form>
</body>

</html>