<!doctype html>
<html>

<head>
    <meta charset="UTF-8">
    <title>Cron任务调度登录</title>
</head>

<link rel="stylesheet" href="../style/mui.min.css">
<link rel="stylesheet" href="../style/mui.showLoading.css">
<script type="text/javascript" src="../jscript/mui.min.js"></script>
<script type="text/javascript" src="../jscript/mui.showLoading.js"></script>
<script type="text/javascript" src="../jscript/jquery-3.4.1.min.js"></script>
<script type="text/javascript" src="../jscript/comm.js"></script>
<script type="text/javascript">
    $(function () {
        $('.change').click(function () {
            mui('.change').button('loading');
            var user = window.sessionStorage['user'];
            user = JSON.parse(user);
            $.ajax({
                url: '/api/user/change/password',
                type: 'post',
                data: JSON.stringify({
                    loginid: user.loginid,
                    oldloginpwd: $('.oldloginpwd').val().trim().toMd5(),
                    loginpwd: $('.loginpwd').val().trim().toMd5()
                }),
                success: function (data) {
                    data = JSON.parse(data);
                    mui('.change').button('reset');
                    if (data.error_code != 0) {
                        mui.alert('修改失败');
                        return;
                    }
                    mui.alert('修改成功', function () {
                        var user = JSON.parse(window.sessionStorage['user']);
                        user.loginpwd = $('.loginpwd').val().trim().toMd5();
                        window.sessionStorage['user'] = JSON.stringify(user);
                        window.location.href = '../main/list.html';
                    });
                },
                error: function () {
                    mui('.login').button('reset');
                    mui.alert('修改失败');
                }
            });
        });
    });
</script>

<body>

</body>
<form style="width: 50%;margin-left: 25%;margin-top: 10%;" class="mui-input-group">
    <div class="mui-input-row">
        <label>旧密码</label>
        <input type="password" class="oldloginpwd mui-input-password" placeholder="请输入密码">
    </div>
    <div class="mui-input-row">
        <label>新密码</label>
        <input type="password" class="loginpwd mui-input-password" placeholder="请输入密码">
    </div>
    <div class="mui-button-row">
        <button type="button" data-loading-text="修改密码中" class="change mui-btn mui-btn-primary">确认修改</button>
    </div>
</form>

</html>